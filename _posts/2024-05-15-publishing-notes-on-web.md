---
layout: post
title: 'Publishing Notes on the Web'
author: Leonid Dubinsky
tags: [obsidian, roam]
date: '2024-05-15'
---
* TOC
{:toc}
## Motivation

Around 04/16/2024, after hearing again somewhere on the Internet that [[Roam]] is dead,
I decided to try some alternatives, and this time around,
I focused on [Obsidian](https://obsidian.md).

I would prefer an [[AsciiDoc]]-based system to a [[MarkDown]]-based one,
but such does not exist...

I am not paranoid about my notes being stored in the cloud, and actually prefer them to be,
since it gets me the ability
to synchronize them across my devices and also guarantees that I am not going to lose them. Still, I thought that if I
set up backup to something like Google Drive, Obsidian could work for me - although I won't be able to use it from my
phone unless I pay for [Obsidian Sync](https://obsidian.md/sync).

One of the advantages of the move: I want to be able to publish my notes easily, in a way that preserves internal links between them ([Digital Garden](https://maggieappleton.com/garden-history)?); [[Roam]] doesn't let me do this, and Obsidian does.

More: I can publish my notes and my blog (currently generated by Jekyll and hosted by GitHub pages) in the same place.

More still: I can host the notes themselves in the same repository as my website and blog!
This way, I do not need any separate backup to Google Drive, and everything is kept together, modified together and published together (notes that I do not want published need to be moved out of the repository).

Also, there is something to be said for the ability to edit my notes using tools other than Obsidian - e.g., IntelliJ Idea ;)

## Import

To move my notes from [[Roam]], I installed [Importer](https://help.obsidian.md/Plugins/Importer) plugin in Obsidian and followed the export/import [instructions](https://help.obsidian.md/import/roam); results of the import required manual clean-up:
- outline bullets from Roam got translated into stars at wrong indent level;
- tags like `#jewish-calendar` that I had at the start of some Roam notes moved into the YAML frontmatter's `tags` array;
- tags like `#buy` and `#learn` were converted to page references like `[​[buy]]` and `[​[learn]]` so that thy are recognized as links by Obsidian and back-links are available at the appropriate pages;
- similarly, TODOs were prefixed by `[​[TODO]]`, to facilitate seeing them in the list of back-links; once done, `[​[TODO]]` becomes a `[​[DONE]]`;
	- [ ] [[TODO]] look into Obsidian plugins that support TODOs
- code blocks needed touch-up;
- I used [Find Orphaned Files and Broken Links](https://github.com/Vinzent03/find-unlinked-files) Obsidian plugin to clean up broken links (it found two block references :)).

## Setup

In this unified setup:
- blog posts are, as usual, under `_posts`;
- blog post drafts - under `_drafts`;
- notes are under `notes`; in Obsidian Settings / Files and Links:
    - Default location for new notes: In the folder specified below
    - Folder to create new notes in: "notes"
- daily notes are under `days`; in Obsidian Settings / Core plugins:
    - Daily notes / New file location: "days"
- [Outliner](https://github.com/vslinko/obsidian-outliner) Obsidian plugin could allegedly help with the Roam-style outlining.

## Publishing

[[Obsidian]] sells its own [Obsidian Publish](https://obsidian.md/publish), but - although Obsidian Publish and Obsidian Sync together cost less than [[Roam]] - I want to explore other publishing options: I would like to publish my notes using a custom domain, but Obsidian Publish supports custom domains only at CloudFlare or some such; also, my goal is to keep my notes in the same GitHub repository as my blog and publish everything from there on GitHub Pages.

I looked (briefly) at [Obsidian digital garden](https://github.com/oleeskild/Obsidian-digital-garden), [Quartz](https://quartz.jzhao.xyz/) and [PublishKit](https://publishkit.dev/), but decided to see first if I can add publish my notes using Jekyll, which I use currently to publish my [blog](http://dub.podval.org).

[GitHub Publisher](https://obsidian-publisher.netlify.app/) is an Obsidian plugin which converts [[Obsidian]] document into a form suitable for publication and pushes them into a GitHub repository. Unfortunately, it can not handle the situation where the source documents are kept in the same GitHub repository: "If you use your vault directly in a repository, the upload will corrupt your files! This module is not intended for this type of workflow."

Even if there was a way to keep both the sources of the notes and the result of their conversion to the publishable form in the same repository, just as I rely on Jekyll running on GitHub pages to convert my [[MarkDown]] to HTML, and do not check in the results of running [[Jekyll]] locally, I prefer not to check in the notes processed for publication by some Obsidian plugins. For now I am pursuing the approach where all the processing needed for publication is handled by Jekyll (with some plugins and other customization), without relying on any Obsidian plugins. Of course, if it turns out to be impossible to make Jekyll produce the results I want, I may have to reconsider this choice of approach.

It used to be the case that GitHub Pages restricted Jekyll plugins that could be used; since I recently switched to [running Jekyll using GitHub Actions workflow](https://jekyllrb.com/docs/continuous-integration/github-actions/) (and soon [everyone will switch](https://docs.github.com/en/pages/getting-started-with-github-pages/configuring-a-publishing-source-for-your-github-pages-site#publishing-with-a-custom-github-actions-workflow)), this is no longer a problem: all Jekyll trickery is available now ;)
The question is: how to make Jekyll do what needs to be done?

## File Names and Titles

Unlike Obsidian, which uses document's file name as its title, many Jekyll plugins and code snippets that I need to make Jekyll do what I want require the pages they process to have titles; my notes, as imported from [[Roam]], do not, so I need to do something about it.

### Jekyll Collections

One possibility is to make `notes` and `days` into [Jekyll Collections](https://jekyllrb.com/docs/collections/), where the member documents have their title, if it is not set explicitly, automatically populated based on the file name - but:
- Jekyll collection directories have their names start with `_`, so the notes will have to reside in the directory `_notes` both in the GitHub repository and on the published website;
-  sub-directories of Jekyll collections get ignored, but I want the ability to have sub-directories in my notes;
- when Jekyll populates the title of the document from its file name, it capitalizes the first letter of each dash-separated segment, and I am not sure that this is what I want.

### Liquid Code

Another possibility is to adjust the code that requires titles to use filename instead (when the title is not set explicitly) - but:
- this works for Liquid and Ruby code snippets, but not for Jekyll plugins - and I probably need those;
- without the title being set explicitly, my notes as they are rendered by Jekyll do not have titles - and I want the titles!

### Linter Obsidian Plugin

So, I need to make sure that my notes always have titles, just like the blog posts. Obviously, adding the title manually to every little note created by just referencing it from another note is tedious and error-prone; I need to automate setting the title for the notes.

[Linter](https://github.com/platers/obsidian-linter) Obsidian plugin can set the title property in each note to its file name; in Obsidian Settings / Community plugins / Linter / Settings:
- General / Lint on save: enabled
- YAML / YAML Title / Insert the title of the file into the YAML frontmatter: enabled

Sometimes I need the title to be different from the file name, for instance, for the manually created `index.md` files that I want to add to Jekyll's list`header_pages` in the `_config.yml`; in such cases, appropriate Linter rule can be disabled by adding a property to the file's YAML frontmatter:
```yaml
---
disabled rules: [yaml-title]
---
```

## Jekyll

Jekyll needs to be enhanced (using Jekyll plugins, layouts and includes and Liquid code snippets) to publish everything the way I want it.

### MathJax

I freshened up my Jekyll MathJax setup by upgrading to MathJax 3; I followed the [instructions](https://www.bodunhu.com/blog/posts/add-mathjax-support-to-jekyll-and-hugo/) of [Bodun Hu](https://www.bodunhu.com/) - a rare find that addresses MathJax 3, as opposed to the more wide-spread instructions for MathJax 2 integration.

To enable MathJax on a page, add `math: true`  to its front matter:
```yaml
---  
...  
math: true  
---
...
```

In `_includes/head.html`:
{% raw %}
```liquid
<head>
  ...
  {%- if page.math == true -%}  
    {% include mathjax.html -%}  
  {%- endif -%}
</head>
```
{% endraw %}

In `_includes.mathjax.html`:
```html
<script>  
  MathJax = {  
    tex: {inlineMath: [ ['$', '$'], ['\\(', '\\)'] ]},  
    svg: {fontCache: 'global'}  
  };  
</script>  
<script  
  type="text/javascript" id="MathJax-script" async  
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"  
>  
</script>
```

### Directory Listing

With the notes published on my website, I want a list of them to be published too - otherwise, nobody can find the individual notes. I [found](https://talk.jekyllrb.com/t/directory-listing-plugin-help/5513/4) a [solution](https://github.com/MichaelCurrin/fractal/blob/master/_includes/structure/page-list.html); thank you, [Michael Currin]( https://github.com/MichaelCurrin)!

I did not make sub-folders appear in the lists automatically yet, not just files, so I add them manually, as content of the index files.

- [ ] [[TODO]] add sub-folders to the folder listing automatically;
- [ ] [[TODO]] generate the index files themselves automatically.
- [ ] [[TODO]] paginate the page list.

In `_layouts/page.html`:
{% raw %}
```liquid
<div class="post-content">
  {{ content }}
  {% if page.name == 'index.md' %}  
    {% include page-list.html %}  
  {% endif %}  
</div>
```
{% endraw %}

In `_includes/page-list.html`:
{% raw %}
```liquid
<ul class="page-list">  
  {% assign pages = site.pages | sort_natural: 'title' %}  
  {%- for item in pages %}  
  {%- if item.dir == page.dir and item.path != page.path %}  
  <li>
    <a href="{{ item.url | relative_url }}">
      <span>{{ item.title }}</span>
    </a>
  </li>  
  {% endif -%}  
  {% endfor -%}  
</ul>
```
{% endraw %}

In `_sass/custom.scss`:
{% raw %}
```css
.page-list {  
  font-size: 18px;  
  
  & i {  
    font-size: 14px;  
    // Based on blockquote.  
    color: #828282;  
  }  
}
```
{% endraw %}

### Wiki Links

Unlike [[Obsidian]], Jekyll does not understand wiki-links. There is a Jekyll plugin for that: [Jekyll Wikirefs](https://github.com/wikibonsai/jekyll-wikirefs), but its 0.0.14 release did not work with current Jekyll; I [asked for an update](https://github.com/wikibonsai/jekyll-wikirefs/issues/1) - and release 0.0.15 [relaxed the dependency requirements](https://github.com/wikibonsai/jekyll-wikirefs/releases/tag/v0.0.15)! Thank you, [manunamz](https://github.com/manunamz)!

In the interim, I used (after tweaking it a bit) a piece of Liquid code that does what needs to be done with *basic* wiki-links: [brackettest](https://github.com/jhvanderschee/brackettest) (listed on the plugin's website :)).

Plugin down-cases page titles; I [asked](https://github.com/wikibonsai/jekyll-wikirefs/issues/2) for this down-casing to be configurable.

Plugin does not respect the boundaries of the code blocks (which  [brackettest](https://github.com/jhvanderschee/brackettest) somehow does), so to stop it from processing wiki-links inside such blocks (for instance, in this post :)), I insert a zero-width space between the two opening brackets: `​​[​[`. I [asked](https://github.com/wikibonsai/jekyll-wikirefs/issues/3) for the plugin to not process links within the code blocks, since the ZWSP work-around is broken: code copied from the affected code blocks is not what it looks like...

Plugin gathers and puts into the front-matter of each page list of back-links to it. To show a list of back-links on a page, in `_layouts/default.html` add (note the use of the `concat` filter to make sure that links from both pages and posts are resolved):
{% raw %}
```liquid
<main ...>  
  <div class="wrapper">  
    {{ content }}  
  
    <div class="backlinks">  
    {% if page.backlinks != blank %}
    <hr/>  
    <h4>Backlinks</h4>  
    {% for backlink in page.backlinks %}  
    {% assign linked_doc = site.pages | concat: site.posts | where: "url", backlink.url | first %}  
    • <a class="backlink" href="{{ linked_doc.url }}">{{ linked_doc.title }}</a>  
    {% endfor %}  
    {% endif %}  
    </div>  
  </div></main>
```
{% endraw %}

Links can be styled in `_sass/custom.scss`:
```css
.wiki-link::before {  content: "[[";  }  
.wiki-link::after {  content: "]]";  }  
.invalid-wiki-link {  background: red;  }  
  
.backlink {  font-style: italic; }
```

- [ ] [[TODO]] look into showing the graph with https://github.com/wikibonsai/jekyll-graph
- [ ] [[TODO]] look deeper into [wikibonsai](https://github.com/wikibonsai/wikibonsai?tab=readme-ov-file)

### Page Tags

To display tags for posts and for pages like notes, in `_includes/tags.html`:
{% raw %}
```liquid
{% if page.tags %} |  
{% for tag in page.tags %}  
<a class="post-tag" href="{{ site.baseurl }}/tags/#{{ tag | slugify }}">{{ tag }}</a>  
{% endfor %}  
{% endif %}
```
{% endraw %}

In `_layouts/post.html`, between the date and the author:
{% raw %}
```liquid
{%- include tags.html -%}
```
{% endraw %}

And in `_layouts/page.html`, after the title:
{% raw %}
```liquid
<p class="post-meta">  
{%- include tags.html -%}  
</p>
```
{% endraw %}

In `_sass/custom.scss`:
```css
.page-tag {  
  display: inline-block;  
  background: $grey-color-light;  
  padding: 0 .5rem;  
  margin-right: .5rem;  
  border-radius: 4px;  
  color: $text-color;  
  font-size: 90%;  
  &:before {  
    content: "\f02b";  
    font-family: FontAwesome;  
    padding-right: .5em;  
  }  
  &:hover {  
    text-decoration: none;  
    background: $grey-color;  
    color: $background-color;  
  }  
}
```

To use the fancy tag character, make fancy font available in `_includes/head.html`:
```html
<head>
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
</head>
```

- [ ] [[TODO]] update the font - or get rid of it if possible

### Tag Pages

Now that I have my blog and my notes in the same repository and in the same Obsidian vault, I can cross-link blog posts and notes; both can have tags in their YAML frontmatter,
and any overall list of tags, tag cloud or whatever I end up publishing on the site needs to include both posts and notes.

There are many code snippets floating around that add listing of tags and documents tagged with them to a site generated by [[Jekyll]], for example: ["an easy way to support tags in a jekyll blog"](https://stackoverflow.com/questions/1408824/an-easy-way-to-support-tags-in-a-jekyll-blog/21002505#21002505), ["listing jekyll posts by tag"](https://www.jokecamp.com/blog/listing-jekyll-posts-by-tag/), ["https://www.maggie98choy.com/Add Tags in Jekyll/"](https://www.maggie98choy.com/Add-Tags-in-Jekyll/),  [jekyll-tagging](https://github.com/pattex/jekyll-tagging) [[Jekyll]] plugin.

All of the samples I saw use `site.tags`, which maps tags to lists of posts that have the tags, but only *posts* are included, not *pages*. To gather tags and associated files across the posts and pages, I copied a [chunk of Jekyll code](https://github.com/jekyll/jekyll/blob/60a9cd73569552b858e807cbd3c0e23455023cbc/lib/jekyll/site.rb#L255), tweaked it to include all posts and pages, tweaked the sorting, packaged it as a Liquid filter and put it into `_plugins/all-tags.rb`:
```ruby
module Jekyll  
  module AllTagsFilter  
    def all_tags(site)  
      @all_tags ||= begin  
       hash = Hash.new { |h, key| h[key] = [] }  
       (site.documents + site.pages).each do |p|  
         p.data["tags"]&.each { |t| hash[t] << p }  
       end  
       hash.each_value { |pages| pages.sort { |a,b| a.data["title"] <=> b.data["title"] }.reverse! }  
       hash  
     end  
    end  endend  
  
Liquid::Template.register_filter(Jekyll::AllTagsFilter)
```

List of tags and pages for each is generated using the `all_tags` filter in the file `tags.html` (which I list under `header_pages` in `_config.yml`):

{% raw %}
```liquid
---  
layout: page  
title: "Tags"  
disabled rules: [yaml-title]  
description: "Pages by tags"  
permalink: /tags/  
---  
  
<div id="tags">  
  {% assign sorted_tags = site | all_tags | sort %}  
  <h2>All tags</h2>  
  <p>
    {% for tag in sorted_tags %}  
    <a class="page-tag" href="{{ site.baseurl }}/tags/#{{ tag[0] | slugify }}">{{ tag[0] }}</a>  
    {% endfor %}  
  </p>  
  <h2>Pages by tags</h2>  
  {% for tag in sorted_tags %}  
  <div id="{{ tag[0] | slugify }}">  
    <h3>{{ tag[0] }}</h3>  
    {% for post in tag[1] %}  
    <ul>  
      <p>
        <a class="post-link" href="{{ post.url | relative_url }}">{{ post.title | escape }}</a>  
      </p>
    </ul>
    {% endfor %}  
  </div>  
  {% endfor %}  
</div>
```
{% endraw %}

- [ ] [[TODO]] Sort the tags and the files in the case-insensitive way.
- [ ] [[TODO]] Look into tag pages aliased to tags (with the help of the [Tag Wrangler](https://github.com/pjeby/tag-wrangler) Obsidian plugin?) to bring tags like `#computer` closer to classifier pages like `[​[buy]]` and `[​[learn]]` (while in [[Roam]] they were equivalent).
### Zotero Integration

- [ ] [[TODO]] [Zotero Sync Client](https://github.com/frthjf/obsidian-zotero-sync-client)
- [ ] [[TODO]] [ZotLit](https://github.com/PKM-er/obsidian-zotlit)
- [ ] [[TODO]] Taking notes directly within Zotero (with two-way sync to Obsidian): [Zotero Better Notes](https://github.com/windingwind/zotero-better-notes)
- [ ] [[TODO]] Importing citations on-demand into Obsidian: [Obsidian Zotero Integration](https://github.com/mgmeyers/obsidian-zotero-integration) or [Obsidian Citation Plugin](https://github.com/hans/obsidian-citation-plugin)
- [ ] [[TODO]] Integrating with Zotero via the ZotServer API: [Zotero Bridge](https://github.com/vanakat/zotero-bridge), [Zotero Link](https://github.com/vanakat/zotero-link).
